---
title: "Bayesian networks in R"
author: "Simon Dirmeier <simon.dirmeier@bsse.ethz.ch>"
date: "17. January 2020"
output:
  xaringan::moon_reader:
    lib_dir: libs
    nature:
      highlightStyle: default
      highlightLanguage: R
      ratio: '16:9'

---

<style type="text/css">
@import url(https://fonts.googleapis.com/css?family=Raleway:400,300,600);

h1, h2, h3 {
  font-family: 'Raleway';
}

.title-slide, .title-slide h1, .title-slide h3 {
  color: black;
  background-color: white;
  text-shadow: none;
  font-family: 'Raleway';
  text-align: left;
}

.title-slide h1 {
  margin-top: 30%;
}

.remark-slide-content {
  font-size: 30px;
  font-family: 'Raleway';
}

a, a code {
  color: maroon;
}

.left-column {
  width: 50%;
  height: 92%;
  float: left;
  color: black;
  padding-top: 0em;
}

.right-column {
  width: 45%;
  height: 92%;
  float: right;
  color: black;
  padding-top: 0em;
}

.mjx-chtml {
  font-size: 30px !important;
  color: black;
}

body {
  color: black;
}

</style>

```{r setup, include=FALSE, echo=FALSE, message=FALSE}
options(htmltools.dir.version = FALSE)
knitr::opts_chunk$set(fig.width=5, fig.height=3, fig.align = "center", message=FALSE, warning = FALSE, dpi=720) 

library(magrittr)
library(ggplot2)
library(tibble)

library(ggdag)
library(dagitty)
library(pcalg)
library(bnlearn)

dag <- dagitty::dagitty('dag {
    RAF [pos="2,2"]
    MEK [pos="2,1"]
    PIP3 [pos="1,0"]
    PIP2 [pos="1,1"]
    PLCG [pos="0,2"]

    RAF -> PIP2 <- PLCG
    PIP2 -> PIP3
    RAF -> MEK
}')

cat.signalling.data <- readRDS("./data/signalling_data-categorical.rds")
signalling.data <- readRDS("./data/signalling_data.rds")

bn <- empty.graph(colnames(cat.signalling.data))
arcs(bn) <- dagitty::edges(dag)[,1:2] %>%
  dplyr::mutate(v = as.character(v), w = as.character(w)) %>%
  dplyr::rename(from=v, to=w)
bn_fit <- bn.fit(bn, cat.signalling.data)
```

# Before we start

- We will use `R` for learning Bayesian networks from data.
- If you want to follow the tutorials on your laptop, you need some packages. Install them using:

```{r, eval=FALSE}
install.packages(c("dagitty", "pcalg", "bnlearn"))
```

- If you want to do them at some point later, the `R` tutorials can be found on: bit.ly/bayesian-networks
 (the `R` files).

---

# What are Bayesian networks

.right-column[
```{r, echo=FALSE, dpi=1200}
ggdag::ggdag(dag) + 
  ggplot2::theme_void()
```

$$\begin{align}
P(\cdot)  = & \, P(\text{PLCG}) \cdot P(\text{RAF}) \\ & \cdot P(\text{MEK} \mid \text{RAF}) \\ & \cdot P(\text{PIP2} \mid \text{RAF}, \text{PLCG}) \\ & \cdot P(\text{PIP3} \mid \text{PIP2})
\end{align}$$
]

.left-column[
A Bayesian network is a probability distribution $P$ of a multivariate random variable that factorizes w.r.t. a directed acyclic graph.

- nodes: random variables $X_i$
- edges: conditional dependencies
- factorization: $P(X) = \prod_i P(X_i \mid \mathbf{pa}_i)$
]

---

# A BN of dependent genes

.left-column[

```{r, echo=FALSE, dpi=1200}
ggdag::ggdag(dag) + 
  ggplot2::theme_void()
```
]

.right-column[
Gene expression levels:
```{r, echo=FALSE}
tibble::as.tibble(cat.signalling.data)
```
]

---

# A BN of dependent genes

.left-column[

```{r, echo=FALSE, dpi=1200}
ggdag::ggdag(dag) + 
  ggplot2::theme_void()
```
]

.right-column[
Conditional probabilities of MEK expression
```{r, echo=FALSE}
bn.fit.dotplot(bn_fit$MEK, main = NULL, xlab = "P(MEK | RAF)", ylab=NULL)
```
]

---

# A BN of dependent genes

Conditional probabilities of PIP2 expression:
```{r, echo=FALSE, fig.height=5, fig.width=10}
bn.fit.dotplot(bn_fit$PIP2, main = NULL, xlab = "P(PIP2 | PLCG, RAF)", ylab=NULL)
```

---

# Let's learn a BN from data
## What do we need ?

- Read the data (`data/singalling_data-categorical.rds`) into `R`.
- Use `bnlearn::tabu`

---

# Let's learn a BN from data
## R tutorial 1

- Read the data (`data/singalling_data-categorical.rds`) into `R`.
- Use `bnlearn::tabu`
